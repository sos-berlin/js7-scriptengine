import java
ApiExecutor = java.type("com.sos.js7.job.jocapi.ApiExecutor")

class JS7Job(js7.Job):
    def __init__(self, jobEnvironment):
        super().__init__(jobEnvironment)
  
    def processOrder(self, step):
        apiExecutor = ApiExecutor(step)
        accessToken = None
        
        try:
            accessToken = apiExecutor.login().getAccessToken()
            step.getLogger().info(f"[accessToken] {accessToken}")

            controllerId = step.getControllerId()
            body = f'{{"controllerId":"{controllerId}"}}'
            response = apiExecutor.post(accessToken, "/monitoring/controllers", body)

            step.getLogger().info(f"[response.getResponseBody] {response.getResponseBody()}")

        except Exception as e:
            raise e 

        finally:
            apiExecutor.logout(accessToken)
            apiExecutor.close()
      